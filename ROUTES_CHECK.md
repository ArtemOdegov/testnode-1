# Проверка соответствия роутов техническому заданию

## Техническое задание

### Требуемые endpoints:
- **POST /api/bookings/reserve** - бронирование места на мероприятие

### Входные данные:
```json
{
  "event_id": 1,
  "user_id": "user123"
}
```

### Требования:
1. Один пользователь не может забронировать дважды на одно событие
2. Таблица `events`: id (SERIAL PRIMARY KEY), name (VARCHAR), total_seats (INT)
3. Таблица `bookings`: id (SERIAL PRIMARY KEY), event_id (INT, ссылка на events), user_id (VARCHAR), created_at (TIMESTAMP)

---

## Проверка реализации

### ✅ POST /api/bookings/reserve

**Путь:** `/api/bookings/reserve`  
**Метод:** `POST`  
**Файл:** `routes/bookings.js:6`

**Проверка соответствия:**

1. **Принимает event_id и user_id** ✅
   - Парсит из `req.body`: `const { event_id, user_id } = req.body;`
   - Валидирует наличие обоих полей (строки 10-14)

2. **Защита от дублирования бронирований** ✅
   - Проверка на уровне приложения (строки 37-47): запрос существующего бронирования
   - Проверка на уровне БД (миграции, строка 25): `UNIQUE(event_id, user_id)`
   - Обработка ошибки уникальности PostgreSQL (строки 83-87): код ошибки `23505`

3. **Структура таблиц** ✅

   **Таблица `events`:**
   - ✅ `id SERIAL PRIMARY KEY` (миграции, строка 12)
   - ✅ `name VARCHAR(255)` (миграции, строка 13)
   - ✅ `total_seats INT` (миграции, строка 14)

   **Таблица `bookings`:**
   - ✅ `id SERIAL PRIMARY KEY` (миграции, строка 21)
   - ✅ `event_id INT NOT NULL REFERENCES events(id)` (миграции, строка 22)
   - ✅ `user_id VARCHAR(255) NOT NULL` (миграции, строка 23)
   - ✅ `created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP` (миграции, строка 24)

4. **Дополнительные проверки (не требуются по ТЗ, но реализованы):**
   - ✅ Проверка существования события (строки 22-32)
   - ✅ Проверка доступности мест (строки 50-61)
   - ✅ Транзакционная обработка (BEGIN/COMMIT/ROLLBACK)
   - ✅ Обработка ошибок с правильными HTTP статусами

### ✅ Дополнительные endpoints

**GET /health** (не требуются по ТЗ, но полезны):
- Проверка состояния сервера и подключения к БД
- Файл: `server.js:27`

**404 Handler:**
- Обработка несуществующих маршрутов
- Файл: `server.js:37`

---

## Итоговая оценка

### ✅ Полностью соответствует техническому заданию

Все требования выполнены:
- ✅ Правильный endpoint (POST /api/bookings/reserve)
- ✅ Правильный формат входных данных
- ✅ Защита от дублирования на двух уровнях (приложение + БД)
- ✅ Структура таблиц полностью соответствует ТЗ
- ✅ Все поля таблиц соответствуют спецификации

### Дополнительные улучшения (опционально)

Реализованы дополнительные проверки, не требуемые по ТЗ, но повышающие надежность:
- Проверка существования события перед бронированием
- Проверка доступности мест (защита от переполнения)
- Транзакционная обработка для целостности данных
- Правильные HTTP статус коды (400, 404, 409, 500)
- Обработка ошибок PostgreSQL

---

## Рекомендации

Все роуты соответствуют техническому заданию. Дополнительных изменений не требуется.

